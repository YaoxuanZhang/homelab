version: 1
entries:
  - model: authentik_providers_proxy.proxyprovider
    identifiers:
      name: "Provider for Traefik"
    attrs:
      internal_host_ssl_validation: true
      mode: forward_single
      external_host: !Env TRAEFIK_DOMAIN
      intercept_header_auth: true
      authorization_flow: !Find [authentik_flows.flow, [slug, default-provider-authorization-implicit-consent]]
      invalidation_flow: !Find [authentik_flows.flow, [slug, default-provider-invalidation-flow]]

  - model: authentik_core.application
    identifiers:
      slug: traefik
    attrs:
      name: Traefik
      policy_engine_mode: any
      provider: !Find [authentik_providers_proxy.proxyprovider, [name, "Provider for Traefik"]]

  - model: authentik_providers_proxy.proxyprovider
    identifiers:
      name: "Provider for Netdata"
    attrs:
      internal_host_ssl_validation: true
      mode: forward_single
      external_host: !Env NETDATA_DOMAIN
      intercept_header_auth: true
      authorization_flow: !Find [authentik_flows.flow, [slug, default-provider-authorization-implicit-consent]]
      invalidation_flow: !Find [authentik_flows.flow, [slug, default-provider-invalidation-flow]]

  - model: authentik_core.application
    identifiers:
      slug: netdata
    attrs:
      name: Netdata
      policy_engine_mode: any
      provider: !Find [authentik_providers_proxy.proxyprovider, [name, "Provider for Netdata"]]

  - model: authentik_providers_proxy.proxyprovider
    identifiers:
      name: "Provider for Kuma"
    attrs:
      internal_host_ssl_validation: true
      mode: forward_single
      external_host: !Env KUMA_DOMAIN
      intercept_header_auth: true
      authorization_flow: !Find [authentik_flows.flow, [slug, default-provider-authorization-implicit-consent]]
      invalidation_flow: !Find [authentik_flows.flow, [slug, default-provider-invalidation-flow]]

  - model: authentik_core.application
    identifiers:
      slug: kuma
    attrs:
      name: Kuma
      policy_engine_mode: any
      provider: !Find [authentik_providers_proxy.proxyprovider, [name, "Provider for Kuma"]]

  - model: authentik_providers_proxy.proxyprovider
    identifiers:
      name: "Provider for Whoami"
    attrs:
      internal_host_ssl_validation: true
      mode: forward_single
      external_host: !Env WHOAMI_DOMAIN
      intercept_header_auth: true
      authorization_flow: !Find [authentik_flows.flow, [slug, default-provider-authorization-implicit-consent]]
      invalidation_flow: !Find [authentik_flows.flow, [slug, default-provider-invalidation-flow]]

  - model: authentik_core.application
    identifiers:
      slug: whoami
    attrs:
      name: Whoami
      policy_engine_mode: any
      provider: !Find [authentik_providers_proxy.proxyprovider, [name, "Provider for Whoami"]]

  - model: authentik_outposts.outpost
    identifiers:
      name: "authentik Embedded Outpost" 
    attrs:
      providers:
        - !Find [authentik_providers_proxy.proxyprovider, [name, "Provider for Traefik"]]
        - !Find [authentik_providers_proxy.proxyprovider, [name, "Provider for Netdata"]]
        - !Find [authentik_providers_proxy.proxyprovider, [name, "Provider for Kuma"]]
        - !Find [authentik_providers_proxy.proxyprovider, [name, "Provider for Whoami"]]