services:
  # Service name for the Stirling-PDF application
  stirling-pdf:
    # Specify the Docker image to use for Stirling-PDF
    image: docker.stirlingpdf.com/stirlingtools/stirling-pdf:latest
    # Set a custom name for the container
    container_name: stirling-pdf
    # Configure the container to restart unless explicitly stopped
    restart: unless-stopped
    environment:
      SECURITY_ENABLELOGIN: false
      DISABLE_ADDITIONAL_FEATURES: false
    labels:
      - traefik.enable=true
      - traefik.http.routers.stirlingpdf.rule=Host(`stirlingpdf.${DOMAIN_NAME}`)
      - traefik.http.routers.stirlingpdf.entrypoints=websecure
      - traefik.http.routers.stirlingpdf.tls=true
      - traefik.http.routers.stirlingpdf.tls.certresolver=cloudflare
      - homepage.group=Apps
      - homepage.href=https://stirlingpdf.${DOMAIN_NAME}
      - homepage.icon=stirling-pdf
      - homepage.name=Stirling PDF
    # Configure healthcheck to verify container is running correctly
    healthcheck:
      # Test container health by curling the web interface
      test: [ "CMD", "curl", "-f", "http://localhost:8080" ]
      # Check every 30 seconds
      interval: 30s
      # Timeout after 10 seconds if no response
      timeout: 10s
      # Retry 3 times before marking unhealthy
      retries: 3
      # Wait 30 seconds before starting health checks
      start_period: 30s
    # Configure logging options for the container
    logging:
      # Use JSON file driver for structured logging
      driver: "json-file"
      # Logging options to manage log file size and retention
      options:
        # Limit individual log file size to 10MB
        max-size: "10m"
        # Keep up to 5 log files before rotating
        max-file: "5"
    # Specify resource limits and reservations for the container
    deploy:
      resources:
        # Define maximum resource limits
        limits:
          # Limit memory usage to 1g
          memory: 1g
          # Limit CPU usage to 1.5 cores
          cpus: "1.5"
        # Define reserved resources
        reservations:
          # Reserve 512MB of memory
          memory: 512M
          # Reserve 1 CPU core
          cpus: "1.0"
    networks:
      - traefik-frontend

networks:
  traefik-frontend:
    external: true
